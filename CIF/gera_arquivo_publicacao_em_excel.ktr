<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>gera_arquivo_publicacao_em_excel</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2015/04/10 10:09:18.411</created_date>
    <modified_user>-</modified_user>
    <modified_date>2015/04/10 10:09:18.411</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>Servidor</name>
    <server>10.209.9.227</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>oltp</database>
    <port>5432</port>
    <username>oltp</username>
    <password>Encrypted 2be98afc86aa7f2e4aa2fa060d3c6a69b</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>02 Relacao_Permissionarios_SEGEP</from>
      <to>Sort rows</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>01 Relacao_Imoveis</from>
      <to>Microsoft Excel writer</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>Microsoft Excel writer 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>03 ImovelFuncional_SituacaoImoveis</from>
      <to>Microsoft Excel writer 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Junta Imóveis e Permissionários</from>
      <to>Microsoft Excel writer 4</to>
      <enabled>N</enabled>
    </hop>
  </order>
  <step>
    <name>01 Relacao_Imoveis</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Servidor</connection>
    <sql>SELECT DISTINCT '1'::char(1) as tipo_registro,
       cast(ORGAO_SIAPE.CODORGSIAPE as char(5)) as cod_orgao_responsavel,
       cast(coalesce(imovel.NOMEENDERECO,'') || ' - BRASILIA/DF ' as char(60)) as endereco_imovel,
      (case when imovel.cep = '' then '00000000' else replace(coalesce(imovel.cep,'00000000'),'-','') end)::char(8)  as cep_imovel,
       case imovel.nomeendereco when 'SQS 311, Bl. D, Ap. 101' then '06' 
       else case situacao.codigosituacao when '12' then '10' when '06' then '07'
       else  lpad(situacao.codigosituacao::char(2),2,'0') end end::char(2) as codigo_situacao_imovel -- mudanca solicitada pelo Vitor no dia 06/05/14
 FROM (select situacaoimovel.endereco, situacaoimovel.SITUACAO, situacaoimovel.dtsituacao
	    from (select situacaoimovel.endereco, MAX (dtsituacao) as dtsituacao
	            from cif.situacaoimovel group by situacaoimovel.endereco) as situacaoimovel2, cif.situacaoimovel
       where situacaoimovel2.endereco = situacaoimovel.endereco 
         and situacaoimovel2.dtsituacao = situacaoimovel.dtsituacao 
         and situacaoimovel.situacao NOT IN (5,70)) as situacaoimoveis_nao_alienados  -- 5 = Alienados | 70 = Outros
	   left join (select ocupanteimovel.endereco, ocupanteimovel.CODIGOOCUPANTE, ocupanteimovel.DTDESOCUPACAO, 	ocupanteimovel.DTOCUPACAO
		            from (select OCUPANTEIMOVEL.endereco, MAX(ocupanteimovel.dtocupacao) as dtocupacao
 			                from cif.OCUPANTEIMOVEL
			               where ocupanteimovel.ENDERECO not in ('01020108570103','01020307510406','01020304570102','01010115550201',
			                                                     '01020108550601','01010109530405','01020410610308','01020106570303',
  			                                                     '04081405530406','01020304550308','01010316520202','01020307570307',
						                                         '01020106600101','01010307580602','01020307520608','04081307510301',
 						                                         '01010210590201','01020308600407')
			               group by OCUPANTEIMOVEL.endereco) as ocupanteimovel2, cif.OCUPANTEIMOVEL
		            where ocupanteimovel2.ENDERECO = ocupanteimovel.ENDERECO 
		              and ocupanteimovel2.dtocupacao = ocupanteimovel.DTOCUPACAO) as ocupante_imovel_ultima_dtocupacao 
	            on situacaoimoveis_nao_alienados.endereco = ocupante_imovel_ultima_dtocupacao.ENDERECO
	
 	    left join cif.SITUACAO on situacao.codigosituacao = situacaoimoveis_nao_alienados.situacao
	    left join cif.OCUPANTE on ocupante_imovel_ultima_dtocupacao.codigoocupante = ocupante.codigoocupante
        left join cif.IMOVEL on imovel.endereco = situacaoimoveis_nao_alienados.ENDERECO and imovel.ENDERECO = ocupante_imovel_ultima_dtocupacao.endereco
	    left join (select codorgcif, codorgsiape from cif.orgao_siape group by codorgcif, codorgsiape) as ORGAO_SIAPE on imovel.cdorgadm = ORGAO_SIAPE.CODORGCIF
	  
  WHERE imovel.endereco is not null -- retirando incosistencias de endereços nulos
    AND	imovel.NOMEENDERECO is not null 
    AND imovel.CDORGADM in ('13000') -- selecionando apenas imoveis sob gestao do MP (ANTIGO '07000')
     -- retirando endereços a pedido da CGAPF
    AND imovel.ENDERECO NOT IN (SELECT ENDERECO FROM cif.v_imoveis_nao_publicados_cgu)
</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>02 Relacao_Permissionarios_SEGEP</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Servidor</connection>
    <sql>SELECT DISTINCT '1'::char(1) as tipo_registro,
       case when situacao.situacao = 'Vago para uso' then NULL 
	        when cgep.nome is null then trim(coalesce(ocupante.nomeocupante,'nao informado'))::char(60) 
            else trim(coalesce(cgep.nome, 'nao informado'))::char(60) end as nome_permissionario,
       case when situacao.situacao = 'Vago para uso' then NULL 
	        when trim(cgep.it_nu_cpf) IS NULL then cast(Rtrim(Ltrim(coalesce(ocupante.cpfocupante,'00000000000'))) as char(11)) 
            else cast(Rtrim(Ltrim(coalesce(cgep.it_nu_cpf,'00000000000'))) as char(11)) end as cpf_permissionario,
       case when situacao.situacao = 'Vago para uso' then null
       else case when cgep.it_sg_funcao is not null then cgep.it_sg_funcao||'-'||cgep.it_co_nivel_funcao::char(100) 
                 when trim(FUNCAO.nomefuncao) is not null then trim(FUNCAO.nomefuncao)::char(100) 
	              else 'FUNCAO NAO INFORMADA'::char(100) end end as descricao_cargo_funcao,
       case when situacao.situacao = 'Vago para uso' then null
            else case when cgep.codorg::char(5) is not null then cgep.codorg::char(5)
                      when trim(ORGAO_SIAPE.CODORGSIAPE)::char(5) is not null 
                           then trim(coalesce(ORGAO_SIAPE.CODORGSIAPE,'0000000'))::char(5)
                      else null end end as orgao_exercicio,
       (case situacao.situacao 
	     when 'Vago para uso' then '' 
	     else cast(Rtrim(Ltrim(coalesce(to_char(ocupante_imovel_ultima_dtocupacao.dtocupacao,'YYYYMMDD'),'00000000'))) as char(8)) END)::char(8) as data_ocupacao,
       (case when situacao.situacao = 'Vago para uso' then NULL 
	         else cast(Rtrim(Ltrim(coalesce(ORGAO_PODER.PODER,'E'))) as char(1)) END)::char(1) as poder_governamental
--------------------------------------------------------------------------------------------------------------------------------------------------
FROM (select situacaoimovel.endereco, situacaoimovel.SITUACAO, situacaoimovel.dtsituacao
	  from (select situacaoimovel.endereco, MAX (dtsituacao) as dtsituacao
		  from cif.situacaoimovel
		 group by situacaoimovel.endereco) as situacaoimovel2, cif.situacaoimovel
	  where	situacaoimovel2.endereco = situacaoimovel.endereco 
	    and	situacaoimovel2.dtsituacao = situacaoimovel.dtsituacao 
	    and	situacaoimovel.situacao NOT IN (5,6,70)) as situacaoimoveis_nao_alienados -- 5 = Alienados | 6= Vago p/ Uso | 70 = Outros
------------------------------------------------------------------------------------------------------------------------------------------
	left join (select ocupanteimovel.endereco, ocupanteimovel.CODIGOOCUPANTE, ocupanteimovel.DTDESOCUPACAO, ocupanteimovel.DTOCUPACAO
		    from (select OCUPANTEIMOVEL.endereco, MAX(ocupanteimovel.dtocupacao) as dtocupacao
			    from cif.OCUPANTEIMOVEL
			   where ocupanteimovel.ENDERECO not in 
			                            ('01020108570103','01020307510406','01020304570102','01010115550201','01020108550601',
						                 '01010109530405','01020410610308','01020106570303','04081405530406','01020304550308',
						                 '01010316520202','01020307570307','01020106600101','01010307580602','01020307520608',
						                 '04081307510301','01010210590201','01020308600407')
		  	  group by OCUPANTEIMOVEL.endereco) as ocupanteimovel2, cif.OCUPANTEIMOVEL
                    where ocupanteimovel2.ENDERECO = ocupanteimovel.ENDERECO 
                      and ocupanteimovel2.dtocupacao = ocupanteimovel.DTOCUPACAO) as ocupante_imovel_ultima_dtocupacao
	 on situacaoimoveis_nao_alienados.endereco = ocupante_imovel_ultima_dtocupacao.ENDERECO
--------------------------------------------------------------------------------------------------------------------------------------
	left join cif.SITUACAO on situacao.codigosituacao = situacaoimoveis_nao_alienados.situacao
	left join cif.OCUPANTE on ocupante_imovel_ultima_dtocupacao.codigoocupante = ocupante.codigoocupante
    --left join cif.servidores_cgep cgep ON lpad(cgep.cpf::text, 11, '0'::text) = ocupante.cpfocupante::text
    left join cif.tb_siape_servidor_dados cgep ON lpad(trim(cgep.it_nu_cpf)::text, 11, '0'::text) = ocupante.cpfocupante::text
	left join cif.ORGAO  on ocupante.CDORGEXERCICIO = ORGAO.CODIGOORGAO
	left join cif.IMOVEL on imovel.endereco = situacaoimoveis_nao_alienados.ENDERECO and imovel.ENDERECO = ocupante_imovel_ultima_dtocupacao.endereco
	left join cif.CARGO on ocupante.codigocargo = CARGO.codigocargo
	left join cif.FUNCAO on ocupante.codigofuncao = FUNCAO.codigofuncao
	left join (select codorgcif, codorgsiape from cif.orgao_siape group by codorgcif, codorgsiape) as ORGAO_SIAPE on ocupante.CDORGEXERCICIO = ORGAO_SIAPE.CODORGCIF
	left join (select codigoorgao, poder from cif.ORGAO_PODER group by codigoorgao, poder) as ORGAO_PODER on ocupante.CDORGEXERCICIO = ORGAO_PODER.CODIGOORGAO
  WHERE -- retirando incosistencias de endereços nulos
	imovel.endereco is not null AND
	imovel.NOMEENDERECO is not null AND
	imovel.CDORGADM in ('13000') AND -- Codigo do orgao do Ministerio do Planejamento (Antigo '07000')
	-- retirando endereços a pedido da CGAPF
	imovel.ENDERECO NOT IN (SELECT ENDERECO FROM cif.v_imoveis_nao_publicados_cgu)
--ORDER BY
--	ocupante.nomeocupante</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>03 ImovelFuncional_SituacaoImoveis</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Servidor</connection>
    <sql>SELECT
    cast ('1' as char(1)) as tipo_registro,
    lpad(cast(CodigoSituacao as char(2)),2,'0')::char(2) as codigo_situacao_imovel,
    case CodigoSituacao 
        when '6'  then cast('Vago' as char(50))
        when '10' then cast('Ocupado' as char(50))
        when '12' then cast('Ocupado' as char(50))
        when '40' then cast('Ocupado' as char(50))
        when '60' then cast('Ocupado' as char(50))
        when '07' then cast('Em alienação' as char(50))
        else cast(Situacao as char(50)) end as nome_situacao_imovel
FROM
    cif.Situacao</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>208</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Junta Imóveis e Permissionários</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Servidor</connection>
    <sql>SELECT DISTINCT 
       id_imovel, 
       rip nu_rip_spiunet,
       "Cd. Órgão CIF" cod_orgao_responsavel, 
       nome_orgao,
       endereco_imovel, 
       cep_imovel, 
       codigo_situacao_imovel, 
       nomeocupante nome_permissionario, 
       cpfocupante cpf_permissionario, 
       dtocupacao::date data_ocupacao
  FROM cif.vw_cif_completo
ORDER BY codigo_situacao_imovel, endereco_imovel; 



</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel writer</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>Y</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name>C:\extracoes\cif\Relação de Imóveis</name>
      <extention>xls</extention>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>Relação de Imóveis</sheetname>
      <autosizecolums>N</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>new</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>tipo_registro</name>
        <type>String</type>
        <format/>
        <title>tipo_registro</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>cod_orgao_responsavel</name>
        <type>String</type>
        <format/>
        <title>cod_orgao_responsavel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>endereco_imovel</name>
        <type>String</type>
        <format/>
        <title>endereco_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>cep_imovel</name>
        <type>String</type>
        <format/>
        <title>cep_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>codigo_situacao_imovel</name>
        <type>String</type>
        <format/>
        <title>codigo_situacao_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>320</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel writer 2</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>Y</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name>C:\extracoes\cif\Permissionários.xls</name>
      <extention>xls</extention>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>Permissionários</sheetname>
      <autosizecolums>N</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>new</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>tipo_registro</name>
        <type>String</type>
        <format/>
        <title>tipo_registro</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>nome_permissionario</name>
        <type>String</type>
        <format/>
        <title>nome_permissionario</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>cpf_permissionario</name>
        <type>String</type>
        <format/>
        <title>cpf_permissionario</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>descricao_cargo_funcao</name>
        <type>String</type>
        <format/>
        <title>descricao_cargo_funcao</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>orgao_exercicio</name>
        <type>String</type>
        <format/>
        <title>orgao_exercicio</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>data_ocupacao</name>
        <type>String</type>
        <format/>
        <title>data_ocupacao</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>poder_governamental</name>
        <type>String</type>
        <format/>
        <title>poder_governamental</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel writer 3</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>Y</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name>C:\extracoes\cif\Tabela de Situação dos Imóveis.xls</name>
      <extention>xls</extention>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>Sheet1</sheetname>
      <autosizecolums>N</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>new</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>tipo_registro</name>
        <type>String</type>
        <format/>
        <title>tipo_registro</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>codigo_situacao_imovel</name>
        <type>String</type>
        <format/>
        <title>codigo_situacao_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>nome_situacao_imovel</name>
        <type>String</type>
        <format/>
        <title>nome_situacao_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>208</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel writer 4</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>Y</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name>C:\extracoes\cif\Relação Completa dos Imóveis Ativos do CIF.xls</name>
      <extention>xls</extention>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>Sheet1</sheetname>
      <autosizecolums>N</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>new</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>id_imovel</name>
        <type>String</type>
        <format/>
        <title>id_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>nu_rip_spiunet</name>
        <type>String</type>
        <format/>
        <title>nu_rip_spiunet</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>cod_orgao_responsavel</name>
        <type>String</type>
        <format/>
        <title>cod_orgao_responsavel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>nome_orgao</name>
        <type>String</type>
        <format/>
        <title>nome_orgao</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>endereco_imovel</name>
        <type>String</type>
        <format/>
        <title>endereco_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>cep_imovel</name>
        <type>String</type>
        <format/>
        <title>cep_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>codigo_situacao_imovel</name>
        <type>String</type>
        <format/>
        <title>codigo_situacao_imovel</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>nome_permissionario</name>
        <type>String</type>
        <format/>
        <title>nome_permissionario</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>cpf_permissionario</name>
        <type>String</type>
        <format/>
        <title>cpf_permissionario</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>data_ocupacao</name>
        <type>Timestamp</type>
        <format>m/d/yyyy</format>
        <title>data_ocupacao</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>368</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>nome_permissionario</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
