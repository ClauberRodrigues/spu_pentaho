<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>dm_posicao_portalnovo</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>PORTAL</name>
        <default_value>10.209.9.200</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PRODUCAO</name>
        <default_value>10.209.9.200</default_value>
        <description/>
      </parameter>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2016/09/01 14:20:00.374</created_date>
    <modified_user>-</modified_user>
    <modified_date>2016/09/01 14:20:00.374</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>Portal</name>
    <server>${PORTAL}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>mpog</database>
    <port>5432</port>
    <username>pentaho</username>
    <password>Encrypted 2be98afc86aa7f2e4cb29fd7eeab2a7f5</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>GeraAnaliseUF</from>
      <to>Microsoft Excel Writer</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>GeraAnaliseServiço</from>
      <to>Microsoft Excel Writer 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Microsoft Excel Writer</from>
      <to>Blocking Step</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking Step</from>
      <to>GeraAnaliseServiço</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Blocking Step</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GeraAnaliseServiço</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Portal</connection>
    <sql>SELECT 1 as ordem,
       ods.ds_sigla "Serviço",  
       coalesce(qtde_primeira_triagem,0) as "Aguardando Primeira Triagem", 
       coalesce(qtde_nova_triagem,0) as "Aguardando Nova Triagem", 
       coalesce(qtde_analise_previa,0) as "Em Análise Prévia", 
       coalesce(qtde_aguardando_requerente,0) as "Aguardando Requerente (Triagem)", 
       coalesce(qtde_aguardando_requerente_sei,0) as "Aguardando Requerente (SEI)",
       coalesce(qtde_at, 0) as "Em Análise Técnica",
       coalesce(qtde_concluido,0) as "Concluídos",
       coalesce(qtde_requerimentos,0) as "Total de Requerimentos"
  FROM 
       (SELECT ods.ds_sigla, count(distinct id_requerimento) as qtde_requerimentos FROM biportal.ods_posicao_carteira ods 
         where id_servico &lt;&gt; '99' GROUP BY ods.ds_sigla) as ods
       --------------- Primeira Triagem --------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_primeira_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 0
                    GROUP BY ds_sigla) tot_primeira_triagem ON tot_primeira_triagem.ds_sigla = ods.ds_sigla 
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Aguardando Nova Triagem --------------------------------------------------------------------------------
        LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_nova_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 1
                    GROUP BY ds_sigla) tot_nova_triagem ON tot_nova_triagem.ds_sigla = ods.ds_sigla
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Em Analise Previa -------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_analise_previa
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Em Análise Prévia' 
                    GROUP BY ds_sigla) tot_analise_previa ON tot_analise_previa.ds_sigla = ods.ds_sigla 
       ------------------------------------------------------------------------------------------------------------------------
       -------------- Aguardando Requerente (Triagem) -------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Aguardando Requerente' 
                      AND id_procedimento_sei is null
                    GROUP BY ds_sigla) tot_aguardando_requerente ON tot_aguardando_requerente.ds_sigla = ods.ds_sigla
       -----------------------------------------------------------------------------------------------------------------------
       --------------------- Agaurdando Requerente (SEI) ---------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente_sei
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Requerente'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_sigla) tot_aguardando_requerente_sei ON tot_aguardando_requerente_sei.ds_sigla = ods.ds_sigla 
       ----------------------------------------------------------------------------------------------------------------------             
       -----------------  Em Analise Técnica --------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_at
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99' 
                      AND ds_situacao_atual = 'Em Análise Técnica'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_sigla) tot_at ON tot_at.ds_sigla = ods.ds_sigla 
      ----------------------------------------------------------------------------------------------------------------------              
      ------------------ Concluido ----------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_concluido
                     FROM biportal.ods_posicao_carteira
                    WHERE cd_posicao_consolidada = 2
                      AND id_servico &lt;&gt; '99'
                    GROUP BY ds_sigla) tot_con ON tot_con.ds_sigla = ods.ds_sigla 
union
SELECT 2 as ordem,
       'Total' as total,
       sum("Aguardando Primeira Triagem") "Aguardando Primeira Triagem",
       sum("Aguardando Nova Triagem") "Aguardando Nova Triagem",
       sum("Em Análise Prévia") "Em Análise Prévia",
       sum("Aguardando Requerente (Triagem)") "Aguardando Requerente (Triagem)",
       sum("Aguardando Requerente (SEI)") "Aguardando Requerente (SEI)",
       sum("Em Análise Técnica") "Em Análise Técnica",
       sum("Concluídos") "Concluídos",
       sum("Total de Requerimentos") "Total de Requerimentos"
  FROM (
        SELECT ods.ds_sigla "UF",  
               coalesce(qtde_primeira_triagem,0) as "Aguardando Primeira Triagem", 
               coalesce(qtde_nova_triagem,0) as "Aguardando Nova Triagem", 
               coalesce(qtde_analise_previa,0) as "Em Análise Prévia", 
               coalesce(qtde_aguardando_requerente,0) as "Aguardando Requerente (Triagem)", 
               coalesce(qtde_aguardando_requerente_sei,0) as "Aguardando Requerente (SEI)",
               coalesce(qtde_at, 0) as "Em Análise Técnica",
               coalesce(qtde_concluido,0) as "Concluídos",
               coalesce(qtde_requerimentos,0) as "Total de Requerimentos"
          FROM 
              (SELECT ods.ds_sigla, count(distinct id_requerimento) as qtde_requerimentos FROM biportal.ods_posicao_carteira ods 
                where id_servico &lt;&gt; '99' GROUP BY ods.ds_sigla) as ods
          --------------- Primeira Triagem --------------------------------------------------------------------------------------
          LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_primeira_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 0
                    GROUP BY ds_sigla) tot_primeira_triagem ON tot_primeira_triagem.ds_sigla = ods.ds_sigla 
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Aguardando Nova Triagem --------------------------------------------------------------------------------
        LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_nova_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 1
                    GROUP BY ds_sigla) tot_nova_triagem ON tot_nova_triagem.ds_sigla = ods.ds_sigla
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Em Analise Previa -------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_analise_previa
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Em Análise Prévia' 
                    GROUP BY ds_sigla) tot_analise_previa ON tot_analise_previa.ds_sigla = ods.ds_sigla 
       ------------------------------------------------------------------------------------------------------------------------
       -------------- Aguardando Requerente (Triagem) -------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Aguardando Requerente' 
                      AND id_procedimento_sei is null
                    GROUP BY ds_sigla) tot_aguardando_requerente ON tot_aguardando_requerente.ds_sigla = ods.ds_sigla
       -----------------------------------------------------------------------------------------------------------------------
       --------------------- Agaurdando Requerente (SEI) ---------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente_sei
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Requerente'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_sigla) tot_aguardando_requerente_sei ON tot_aguardando_requerente_sei.ds_sigla = ods.ds_sigla 
       ----------------------------------------------------------------------------------------------------------------------             
       -----------------  Em Analise Técnica --------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_at
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99' 
                      AND ds_situacao_atual = 'Em Análise Técnica'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_sigla) tot_at ON tot_at.ds_sigla = ods.ds_sigla 
      ----------------------------------------------------------------------------------------------------------------------              
      ------------------ Concluido ----------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_sigla, coalesce(count(distinct id_requerimento),0) as qtde_concluido
                     FROM biportal.ods_posicao_carteira
                    WHERE cd_posicao_consolidada = 2
                      AND id_servico &lt;&gt; '99'
                    GROUP BY ds_sigla) tot_con ON tot_con.ds_sigla = ods.ds_sigla) TOTAL 
ORDER BY 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>80</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GeraAnaliseUF</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Portal</connection>
    <sql>SELECT ods.ds_uf "UF",  
       coalesce(qtde_primeira_triagem,0) as "Aguardando Primeira Triagem", 
       coalesce(qtde_nova_triagem,0) as "Aguardando Nova Triagem", 
       coalesce(qtde_analise_previa,0) as "Em Análise Prévia", 
       coalesce(qtde_aguardando_requerente,0) as "Aguardando Requerente (Triagem)", 
       coalesce(qtde_aguardando_requerente_sei,0) as "Aguardando Requerente (SEI)",
       coalesce(qtde_at, 0) as "Em Análise Técnica",
       coalesce(qtde_concluido,0) as "Concluídos",
       coalesce(qtde_requerimentos,0) as "Total de Requerimentos"
  FROM 
       (SELECT ods.ds_uf, count(distinct id_requerimento) as qtde_requerimentos FROM biportal.ods_posicao_carteira ods 
         where id_servico &lt;&gt; '99' GROUP BY ods.ds_uf) as ods
       --------------- Primeira Triagem --------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_primeira_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 0
                    GROUP BY ds_uf) tot_primeira_triagem ON tot_primeira_triagem.ds_uf = ods.ds_uf 
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Aguardando Nova Triagem --------------------------------------------------------------------------------
        LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_nova_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 1
                    GROUP BY ds_uf) tot_nova_triagem ON tot_nova_triagem.ds_uf = ods.ds_uf
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Em Analise Previa -------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_analise_previa
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Em Análise Prévia' 
                    GROUP BY ds_uf) tot_analise_previa ON tot_analise_previa.ds_uf = ods.ds_uf 
       ------------------------------------------------------------------------------------------------------------------------
       -------------- Aguardando Requerente (Triagem) -------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Aguardando Requerente' 
                      AND id_procedimento_sei is null
                    GROUP BY ds_uf) tot_aguardando_requerente ON tot_aguardando_requerente.ds_uf = ods.ds_uf
       -----------------------------------------------------------------------------------------------------------------------
       --------------------- Agaurdando Requerente (SEI) ---------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente_sei
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Requerente'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_uf) tot_aguardando_requerente_sei ON tot_aguardando_requerente_sei.ds_uf = ods.ds_uf 
       ----------------------------------------------------------------------------------------------------------------------             
       -----------------  Em Analise Técnica --------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_at
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99' 
                      AND ds_situacao_atual = 'Em Análise Técnica'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_uf) tot_at ON tot_at.ds_uf = ods.ds_uf 
      ----------------------------------------------------------------------------------------------------------------------              
      ------------------ Concluido ----------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_concluido
                     FROM biportal.ods_posicao_carteira
                    WHERE cd_posicao_consolidada = 2
                      AND id_servico &lt;&gt; '99'
                    GROUP BY ds_uf) tot_con ON tot_con.ds_uf = ods.ds_uf 
union
SELECT 'Total' as total,
       sum("Aguardando Primeira Triagem") "Aguardando Primeira Triagem",
       sum("Aguardando Nova Triagem") "Aguardando Nova Triagem",
       sum("Em Análise Prévia") "Em Análise Prévia",
       sum("Aguardando Requerente (Triagem)") "Aguardando Requerente (Triagem)",
       sum("Aguardando Requerente (SEI)") "Aguardando Requerente (SEI)",
       sum("Em Análise Técnica") "Em Análise Técnica",
       sum("Concluídos") "Concluídos",
       sum("Total de Requerimentos") "Total de Requerimentos"
  FROM (
        SELECT ods.ds_uf "UF",  
               coalesce(qtde_primeira_triagem,0) as "Aguardando Primeira Triagem", 
               coalesce(qtde_nova_triagem,0) as "Aguardando Nova Triagem", 
               coalesce(qtde_analise_previa,0) as "Em Análise Prévia", 
               coalesce(qtde_aguardando_requerente,0) as "Aguardando Requerente (Triagem)", 
               coalesce(qtde_aguardando_requerente_sei,0) as "Aguardando Requerente (SEI)",
               coalesce(qtde_at, 0) as "Em Análise Técnica",
               coalesce(qtde_concluido,0) as "Concluídos",
               coalesce(qtde_requerimentos,0) as "Total de Requerimentos"
          FROM 
              (SELECT ods.ds_uf, count(distinct id_requerimento) as qtde_requerimentos FROM biportal.ods_posicao_carteira ods 
                where id_servico &lt;&gt; '99' GROUP BY ods.ds_uf) as ods
          --------------- Primeira Triagem --------------------------------------------------------------------------------------
          LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_primeira_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 0
                    GROUP BY ds_uf) tot_primeira_triagem ON tot_primeira_triagem.ds_uf = ods.ds_uf 
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Aguardando Nova Triagem --------------------------------------------------------------------------------
        LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_nova_triagem
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Triagem'
                      AND existe_historico = 1
                    GROUP BY ds_uf) tot_nova_triagem ON tot_nova_triagem.ds_uf = ods.ds_uf
       ------------------------------------------------------------------------------------------------------------------------
       --------------- Em Analise Previa -------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_analise_previa
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Em Análise Prévia' 
                    GROUP BY ds_uf) tot_analise_previa ON tot_analise_previa.ds_uf = ods.ds_uf 
       ------------------------------------------------------------------------------------------------------------------------
       -------------- Aguardando Requerente (Triagem) -------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual =  'Aguardando Requerente' 
                      AND id_procedimento_sei is null
                    GROUP BY ds_uf) tot_aguardando_requerente ON tot_aguardando_requerente.ds_uf = ods.ds_uf
       -----------------------------------------------------------------------------------------------------------------------
       --------------------- Agaurdando Requerente (SEI) ---------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_aguardando_requerente_sei
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99'
                      AND ds_situacao_atual = 'Aguardando Requerente'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_uf) tot_aguardando_requerente_sei ON tot_aguardando_requerente_sei.ds_uf = ods.ds_uf 
       ----------------------------------------------------------------------------------------------------------------------             
       -----------------  Em Analise Técnica --------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_at
                     FROM biportal.ods_posicao_carteira
                    WHERE id_servico &lt;&gt; '99' 
                      AND ds_situacao_atual = 'Em Análise Técnica'
                      AND id_procedimento_sei is not null
                    GROUP BY ds_uf) tot_at ON tot_at.ds_uf = ods.ds_uf 
      ----------------------------------------------------------------------------------------------------------------------              
      ------------------ Concluido ----------------------------------------------------------------------------------------
       LEFT JOIN (SELECT ds_uf, coalesce(count(distinct id_requerimento),0) as qtde_concluido
                     FROM biportal.ods_posicao_carteira
                    WHERE cd_posicao_consolidada = 2
                      AND id_servico &lt;&gt; '99'
                    GROUP BY ds_uf) tot_con ON tot_con.ds_uf = ods.ds_uf) TOTAL 
ORDER BY 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel Writer</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>Y</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name>E:\extracaoarquivos\PortalServicos\PosicaoCarteira\Rel_Analise_UF</name>
      <extention>xls</extention>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>Y</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>UF</sheetname>
      <autosizecolums>Y</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>new</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>UF</name>
        <type>String</type>
        <format/>
        <title>UF</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Primeira Triagem</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Primeira Triagem</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Nova Triagem</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Nova Triagem</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Em Análise Prévia</name>
        <type>BigNumber</type>
        <format/>
        <title>Em Análise Prévia</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Requerente (Triagem)</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Requerente (Triagem)</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Requerente (SEI)</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Requerente (SEI)</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Em Análise Técnica</name>
        <type>BigNumber</type>
        <format/>
        <title>Em Análise Técnica</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Concluídos</name>
        <type>BigNumber</type>
        <format/>
        <title>Concluídos</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Total de Requerimentos</name>
        <type>BigNumber</type>
        <format/>
        <title>Total de Requerimentos</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>352</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel Writer 2</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>N</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>N</add_to_result_filenames>
    <file>
      <name>E:\extracaoarquivos\PortalServicos\PosicaoCarteira\Rel_Analise_Serviço</name>
      <extention>xls</extention>
      <do_not_open_newfile_init>Y</do_not_open_newfile_init>
      <split>N</split>
      <add_date>Y</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>Serviço</sheetname>
      <autosizecolums>Y</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>reuse</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>SERVIÇO</name>
        <type>String</type>
        <format/>
        <title>SERVIÇO</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Primeira Triagem</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Primeira Triagem</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Nova Triagem</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Nova Triagem</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Em Análise Prévia</name>
        <type>BigNumber</type>
        <format/>
        <title>Em Análise Prévia</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Requerente (Triagem)</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Requerente (Triagem)</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Aguardando Requerente (SEI)</name>
        <type>BigNumber</type>
        <format/>
        <title>Aguardando Requerente (SEI)</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Em Análise Técnica</name>
        <type>BigNumber</type>
        <format/>
        <title>Em Análise Técnica</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Concluídos</name>
        <type>BigNumber</type>
        <format/>
        <title>Concluídos</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Total de Requerimentos</name>
        <type>BigNumber</type>
        <format/>
        <title>Total de Requerimentos</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>352</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
