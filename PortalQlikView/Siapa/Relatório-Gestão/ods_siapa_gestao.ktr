<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>ods_siapa_gestao</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>OLTP</name>
        <default_value>10.209.9.227</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>SERVIDOR</name>
        <default_value>10.209.9.227</default_value>
        <description/>
      </parameter>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2016/04/25 17:30:31.206</created_date>
    <modified_user>-</modified_user>
    <modified_date>2016/04/25 17:30:31.206</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>bispu</name>
    <server>${SERVIDOR}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>bispu</database>
    <port>5432</port>
    <username>bispu</username>
    <password>Encrypted 2be98afc86aa7f2e4aa2fa060d3c6a69b</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>oltp</name>
    <server>${OLTP}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>oltp</database>
    <port>5432</port>
    <username>postgres</username>
    <password>Encrypted 2be98afc86aa7c683ea53be7fd0c282ea</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>oltp</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>ods</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>nu_rip</name>
      </field>
      <field>
        <name>sg_uf</name>
      </field>
      <field>
        <name>cod_municipio</name>
      </field>
      <field>
        <name>nome_municipio</name>
      </field>
      <field>
        <name>da_inclusao_cad_imov</name>
      </field>
      <field>
        <name>da_informacao_imov</name>
      </field>
      <field>
        <name>co_classe_imov</name>
      </field>
      <field>
        <name>no_classe_imov</name>
      </field>
      <field>
        <name>co_tipo_ocupacao</name>
      </field>
      <field>
        <name>no_tipo_ocupacao</name>
      </field>
      <field>
        <name>ed_tipo_logr</name>
      </field>
      <field>
        <name>ed_logr</name>
      </field>
      <field>
        <name>ed_numero</name>
      </field>
      <field>
        <name>ed_complemento</name>
      </field>
      <field>
        <name>ed_bairro_distrito</name>
      </field>
      <field>
        <name>ed_cep</name>
      </field>
      <field>
        <name>co_natureza_terreno</name>
      </field>
      <field>
        <name>no_natureza_terreno</name>
      </field>
      <field>
        <name>co_conceituacao_terreno</name>
      </field>
      <field>
        <name>no_conceituacao_terreno</name>
      </field>
      <field>
        <name>co_fundamento_incorporacao</name>
      </field>
      <field>
        <name>tx_fundamento_incorporacao</name>
      </field>
      <field>
        <name>nu_inscricao_municipal</name>
      </field>
      <field>
        <name>nu_processo_lpm_lmeo</name>
      </field>
      <field>
        <name>da_aprovacao_lpm_lmeo</name>
      </field>
      <field>
        <name>co_tipo_fracao_ideal</name>
      </field>
      <field>
        <name>op_fracao_ideal_decimal</name>
      </field>
      <field>
        <name>op_fracao_ideal_numerador</name>
      </field>
      <field>
        <name>op_fracao_ideal_denominador</name>
      </field>
      <field>
        <name>op_fracao_ideal_percentual</name>
      </field>
      <field>
        <name>mq_area_terreno_total</name>
      </field>
      <field>
        <name>mq_area_terreno_uniao</name>
      </field>
      <field>
        <name>nu_resp</name>
      </field>
      <field>
        <name>cpf_cgc</name>
      </field>
      <field>
        <name>no_resp</name>
      </field>
      <field>
        <name>ic_carente</name>
      </field>
      <field>
        <name>sg_pais</name>
      </field>
      <field>
        <name>nu_utiliz</name>
      </field>
      <field>
        <name>co_regime_utiliz</name>
      </field>
      <field>
        <name>no_regime_utiliz</name>
      </field>
      <field>
        <name>pe_taxa_ocupacao</name>
      </field>
      <field>
        <name>co_situacao_regime</name>
      </field>
      <field>
        <name>no_situacao_regime</name>
      </field>
      <field>
        <name>mq_area_uniao_utilizada</name>
      </field>
      <field>
        <name>mq_area_primitiva_utilizada</name>
      </field>
      <field>
        <name>co_situacao_testada_terr_total</name>
      </field>
      <field>
        <name>no_situacao_testada</name>
      </field>
      <field>
        <name>op_fator_testada_multipla</name>
      </field>
      <field>
        <name>op_fator_corretivo_total</name>
      </field>
      <field>
        <name>nu_logr_trecho_calculo</name>
      </field>
      <field>
        <name>valor_imovel</name>
      </field>
      <field>
        <name>nu_logr_trecho_testada1</name>
      </field>
      <field>
        <name>nu_logradouro_testada1</name>
      </field>
      <field>
        <name>va_generico_m2_terreno_testada1</name>
      </field>
      <field>
        <name>da_inicio_avaliacao_pvg_testada1</name>
      </field>
      <field>
        <name>no_logr_testada1</name>
      </field>
      <field>
        <name>nu_logr_trecho_testada2</name>
      </field>
      <field>
        <name>nu_logradouro_testada2</name>
      </field>
      <field>
        <name>va_generico_m2_terreno_testada2</name>
      </field>
      <field>
        <name>da_inicio_avaliacao_pvg_testada2</name>
      </field>
      <field>
        <name>no_logr_testada2</name>
      </field>
      <field>
        <name>nu_logr_trecho_testada3</name>
      </field>
      <field>
        <name>nu_logradouro_testada3</name>
      </field>
      <field>
        <name>va_generico_m2_terreno_testada3</name>
      </field>
      <field>
        <name>da_inicio_avaliacao_pvg_testada3</name>
      </field>
      <field>
        <name>no_logr_testada3</name>
      </field>
      <field>
        <name>nu_logr_trecho_testada4</name>
      </field>
      <field>
        <name>nu_logradouro_testada4</name>
      </field>
      <field>
        <name>va_generico_m2_terreno_testada4</name>
      </field>
      <field>
        <name>da_inicio_avaliacao_pvg_testada4</name>
      </field>
      <field>
        <name>no_logr_testada4</name>
      </field>
      <field>
        <name>mq_area_construida</name>
      </field>
      <field>
        <name>in_imovel_em_ilha</name>
      </field>
      <field>
        <name>va_generico_m2_terreno_calculo</name>
      </field>
      <field>
        <name>nu_rip_primitivo</name>
      </field>
      <field>
        <name>da_recepcao_requerimento</name>
      </field>
      <field>
        <name>da_contrato_aforamento</name>
      </field>
      <field>
        <name>dt_inicio_utiliz</name>
      </field>
      <field>
        <name>in_cpf_cgc</name>
      </field>
      <field>
        <name>da_inicio_avaliacao_pvg_calculo</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>ods</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>bispu</connection>
    <schema>dw_siapa</schema>
    <table>ods_siapa_gestao</table>
    <commit>1000</commit>
    <truncate>Y</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>N</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>352</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>oltp</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>oltp</connection>
    <sql> select -- Imovel
       DISTINCT
       i.nu_rip, ie.sg_uf, i.ed_mun cod_municipio, ie.no_mun nome_municipio,
       (case when i.da_inclusao_cad_imov = '1900-01-01 00:00:00' then null
             else to_char(i.da_inclusao_cad_imov,'DD-MM-YYYY') end) da_inclusao_cad_imov, 
       (case when da_informacao_imov = '1900-01-01 00:00:00' then null 
             else to_char(da_informacao_imov,'DD-MM-YYYY') end) da_informacao_imov, 
       i.co_classe_imov, ci.no_classe_imov,
       -- Imovel Endereco
       i.co_tipo_ocupacao, ito.no_tipo_ocupacao, 
       --i.ed_tipo_logr, i.ed_logr, i.ed_numero, i.ed_complemento,
       --i.ed_bairro_distrito, i.ed_cep, /*i.ed_mun, ie.no_mun,*/
       i.ed_tipo_logr,
       i.ed_logr,
       i.ed_numero,
       i.ed_complemento,
       i.ed_bairro_distrito,     
       i.ed_cep,
       i.nu_rip_primitivo,
       -- Dados do Terreno --------------------------------------------------
       case when i.co_natureza_terreno in ('1','2') then i.co_natureza_terreno else '0' end co_natureza_terreno, nt.no_natureza_terreno, 
       i.co_conceituacao_terreno, ct.no_conceituacao_terreno,
       i.co_fundamento_incorporacao, fi.tx_fundamento_incorporacao,
       i.nu_inscricao_municipal, i.nu_processo_lpm_lmeo, 
       (case when i.da_aprovacao_lpm_lmeo = '0002-11-30 00:00:00 BC' then null 
             else to_char(i.da_aprovacao_lpm_lmeo,'DD-MM-YYYY') end) da_aprovacao_lpm_lmeo, 
       i.co_tipo_fracao_ideal, 
	  -- CASE WHEN i.co_tipo_fracao_ideal='D' THEN 'Denominador'
      --    WHEN i.co_tipo_fracao_ideal='N' THEN 'Numerador'
      --   WHEN i.co_tipo_fracao_ideal='P' THEN 'Percentual'
      --    ELSE '--'
      -- END no_tipo_fracao_ideal,
      -- CASE WHEN i.co_tipo_fracao_ideal='D' THEN i.op_fracao_ideal_decimal
      --    WHEN i.co_tipo_fracao_ideal='N' THEN (i.op_fracao_ideal_numerador/i.op_fracao_ideal_denominador)
      --    WHEN i.co_tipo_fracao_ideal='P' THEN (i.op_fracao_ideal_percentual/100)
      --    ELSE 0
      -- END op_fracao_ideal_calculada,
	   i.op_fracao_ideal_decimal, i.op_fracao_ideal_numerador, i.op_fracao_ideal_denominador, i.op_fracao_ideal_percentual,
       i.mq_area_terreno_total, i.mq_area_terreno_uniao, 

       -- dados responsavel
       case when re.nu_resp is null then '000000000' else re.nu_resp end nu_resp,
       re.in_cpf_cgc, re.cpf_cgc, re.no_resp, rp.sg_pais, 
      -- CASE WHEN rp.sg_pais='BRA' THEN 'Brasileiro'
      --    WHEN rp.sg_pais is null THEN 'Sem Informação'
      --    ELSE 'Estrangeiro'
      -- END sg_nacional_estrangeiro,      
       case when carencia.nu_resp is not null then 'SIM' 
            when u.in_isencao_foro = 'S' then 'SIM'
            else 'NÃO' end ic_carente, 
       
       -- Utilizacao 
       u.nu_utiliz, case when u.co_regime_utiliz is null then '00' else u.co_regime_utiliz end co_regime_utiliz,
       case when u.co_regime_utiliz is null then 'AGUARDANDO DESTINAÇÃO' else ru.no_regime_utiliz end no_regime_utiliz, 
       u.pe_taxa_ocupacao,
       u.co_situacao_regime, 
       str.no_situacao_regime, 
       mq_area_uniao_utilizada, mq_area_primitiva_utilizada, 
	   --CASE WHEN (i.mq_area_terreno_total > 0) THEN (u.mq_area_uniao_utilizada / i.mq_area_terreno_total) ELSE 0 END area_utiliz_por_total_imovel,
       --CASE WHEN (i.mq_area_terreno_uniao > 0) THEN (u.mq_area_uniao_utilizada / i.mq_area_terreno_uniao) ELSE 0 END area_utiliz_por_pertence_uniao,
       case when u.da_contrato_aforamento = '0002-11-30 00:00:00 BC' then null else u.da_contrato_aforamento end da_contrato_aforamento,
       case when u.da_recepcao_requerimento = '0002-11-30 00:00:00 BC' then null else u.da_recepcao_requerimento end da_recepcao_requerimento,
       case when u.co_regime_utiliz = '01' and u.da_recepcao_requerimento != '0002-11-30 00:00:00 BC' then u.da_recepcao_requerimento 
            when u.co_regime_utiliz = '02' and u.da_contrato_aforamento != '0002-11-30 00:00:00 BC' then u.da_contrato_aforamento
            else null end dt_inicio_utiliz,
       -- Testadas 
       i.co_situacao_testada_terr_total, stt.no_situacao_testada, i.op_fator_testada_multipla, i.op_fator_corretivo_total, 
       case when vu.nu_logr_trecho_calculo is null then '00000000' else vu.nu_logr_trecho_calculo end nu_logr_trecho_calculo, 
       iv.valor_imovel, vu.va_generico_m2_terreno va_generico_m2_terreno_calculo, vu.da_inicio_avaliacao_pvg da_inicio_avaliacao_pvg_calculo,

       -- Testada 1
       case when pvg1.nu_logr_trecho_calculo is null then '00000000' else i.nu_logr_trecho_testada1 end nu_logr_trecho_testada1, 
       case when pvg1.nu_logr_trecho_calculo is null then '00000000' else SUBSTRING(i.nu_logr_trecho_testada1,1,6) end nu_logradouro_testada1,
       case when pvg1.nu_logr_trecho_calculo is null then 0 else pvg1.va_generico_m2_terreno end va_generico_m2_terreno_testada1,
       pvg1.da_inicio_avaliacao_pvg da_inicio_avaliacao_pvg_testada1, pvgl1.no_logr no_logr_testada1,
       -- Testada 2
       case when pvg2.nu_logr_trecho_calculo is null then '00000000' else i.nu_logr_trecho_testada2 end nu_logr_trecho_testada2, 
       case when pvg2.nu_logr_trecho_calculo is null then '00000000' else SUBSTRING(i.nu_logr_trecho_testada2,1,6) end nu_logradouro_testada2,
       case when pvg2.nu_logr_trecho_calculo is null then 0 else pvg2.va_generico_m2_terreno end va_generico_m2_terreno_testada2,
       pvg2.da_inicio_avaliacao_pvg da_inicio_avaliacao_pvg_testada2, pvgl2.no_logr no_logr_testada2,
       -- Testada 3
       case when pvg3.nu_logr_trecho_calculo is null then '00000000' else i.nu_logr_trecho_testada3 end nu_logr_trecho_testada3, 
       case when pvg3.nu_logr_trecho_calculo is null then '00000000' else SUBSTRING(i.nu_logr_trecho_testada3,1,6) end nu_logradouro_testada3,
       case when pvg3.nu_logr_trecho_calculo is null then 0 else pvg3.va_generico_m2_terreno end va_generico_m2_terreno_testada3,
       pvg3.da_inicio_avaliacao_pvg da_inicio_avaliacao_pvg_testada3, pvgl3.no_logr no_logr_testada3,
       -- Testada 4
       case when pvg4.nu_logr_trecho_calculo is null then '00000000' else i.nu_logr_trecho_testada4 end nu_logr_trecho_testada4, 
       case when pvg4.nu_logr_trecho_calculo is null then '00000000' else SUBSTRING(i.nu_logr_trecho_testada4,1,6) end nu_logradouro_testada4,
       case when pvg4.nu_logr_trecho_calculo is null then 0 else pvg4.va_generico_m2_terreno end va_generico_m2_terreno_testada4,
       pvg4.da_inicio_avaliacao_pvg da_inicio_avaliacao_pvg_testada4, pvgl4.no_logr no_logr_testada4,
 
       -- Dados da Benfeitoria
       benf.mq_area_construida,
       -- Dados complementares
       case when i.in_imovel_em_ilha = 'S' then 'Imóvel em Ilha'::text 
            else 'Normal' end in_imovel_em_ilha
  from siapa.siapa_a_imovel i 
       -- informaĆ§Ćµes sobre o imĆ³vel
       left join siapa.siapa_t_imovel_valor iv on iv.nu_rip = i.nu_rip
       left join (SELECT b.nu_rip, sum(mq_area_construida) mq_area_construida
                    FROM siapa.siapa_a_benfeitoria b
                   WHERE co_situacao_benf = '1' -- Somente Benfeitorias ativas
                   GROUP BY b.nu_rip) as benf on benf.nu_rip = i.nu_rip
       left  join siapa.siapa_t_municipio ie on i.ed_mun = ie.nu_mun
       left  join siapa.siapa_t_classe_imovel ci on i.co_classe_imov = ci.co_classe_imov
       left  join siapa.siapa_t_tipoocupacao ito on i.co_tipo_ocupacao = ito.co_tipo_ocupacao --tabela vazia ver com Marcelo
       left  join siapa.siapa_t_naturezaterreno nt on i.co_natureza_terreno = nt.co_natureza_terreno
       left  join siapa.siapa_t_conceituacao_terreno ct on i.co_conceituacao_terreno = ct.co_conceituacao_terreno
       left  join siapa.siapa_t_fundamento_incorporacao fi on i.co_fundamento_incorporacao = fi.co_fundamento_incorporacao
       left  join siapa.siapa_v_situacao_testada stt on stt.co_situacao_testada = i.co_situacao_testada_terr_total
       left  join siapa.siapa_t_imovel_testada_valor_unico vu on vu.nu_rip = i.nu_rip
       -- Testadas 
       -- T1
       left  join siapa.siapa_t_imovel_testada_valor_corrente pvg1 
             ON i.nu_rip = pvg1.nu_rip
             AND i.ed_mun = pvg1.nu_mun
             AND i.nu_logr_trecho_testada1 = pvg1.nu_logr_trecho_calculo
             
       left join siapa.v_mer_pvg_logrador pvgl1 
             on  pvgl1.nu_mun_pvg_logr = i.ed_mun
             and pvgl1.nu_logr_pvg_logr = substring(i.nu_logr_trecho_testada1,1,6)
       -- T2 
       left  join siapa.siapa_t_imovel_testada_valor_corrente pvg2 
              ON i.nu_rip = pvg2.nu_rip
             AND i.ed_mun = pvg2.nu_mun
             AND i.nu_logr_trecho_testada2 = pvg2.nu_logr_trecho_calculo
             
       left join siapa.v_mer_pvg_logrador pvgl2 
             on  pvgl2.nu_mun_pvg_logr = i.ed_mun
             and pvgl2.nu_logr_pvg_logr = substring(i.nu_logr_trecho_testada2,1,6)

       -- T3 
       left  join siapa.siapa_t_imovel_testada_valor_corrente pvg3 
               ON i.nu_rip = pvg3.nu_rip
              AND i.ed_mun = pvg3.nu_mun
              AND i.nu_logr_trecho_testada3 = pvg3.nu_logr_trecho_calculo
   
       left join siapa.v_mer_pvg_logrador pvgl3 
             on  pvgl3.nu_mun_pvg_logr = i.ed_mun
             and pvgl3.nu_logr_pvg_logr = substring(i.nu_logr_trecho_testada3,1,6)

       -- T4 
       left  join siapa.siapa_t_imovel_testada_valor_corrente pvg4 
              ON i.nu_rip = pvg4.nu_rip
             AND i.ed_mun = pvg4.nu_mun
             AND i.nu_logr_trecho_testada4 = pvg4.nu_logr_trecho_calculo

       left join siapa.v_mer_pvg_logrador pvgl4 
             on  pvgl4.nu_mun_pvg_logr = i.ed_mun
             and pvgl4.nu_logr_pvg_logr = substring(i.nu_logr_trecho_testada4,1,6)

       -- informaçoes sobre utilizacao
       left join  siapa.siapa_a_utilizacao u 
            left  join siapa.siapa_t_situacao_regime str on str.co_situacao_regime = u.co_situacao_regime
            inner join siapa.siapa_t_regime_utilizacao ru on u.co_regime_utiliz = ru.co_regime_utiliz
            inner join siapa.siapa_a_responsavel rp 
                  inner join siapa.siapa_t_responsaveis re on rp.nu_resp = re.nu_resp
            on u.nu_resp = rp.nu_resp

            left  join (select distinct nu_resp, nu_rip from siapa.siapa_a_carencia 
                         where an_referencia_carencia &lt;= extract(year from current_date)-4) carencia 
                  on carencia.nu_rip = u.nu_rip and carencia.nu_resp = rp.nu_resp      
            
       on i.nu_rip = u.nu_rip and u.co_estado_utiliz = '1' --somente utilizaĆ§Ćµes ativas
 WHERE i.co_situacao_imov = '1'  -- somente imoveis ativos</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>80</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
